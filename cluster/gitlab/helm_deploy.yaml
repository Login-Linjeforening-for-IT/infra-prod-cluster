---
apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: gitlab-prod
  namespace: gitlab
spec:
  interval: 5m
  chart:
    spec:
      chart: gitlab
      version: "7.6.0"
      sourceRef:
        kind: HelmRepository
        name: gitlab-repo
        namespace: gitlab
      interval: 1m
  values:
    global:
      hosts:
        domain: login.no
        https: true
        gitlab:
          name: git.login.no
          https: true
        registry:
          name: registry.login.no
          https: true
        pages:
          name: pages.login.no
          https: true
      edition: ce
      ingress:
        configureCertmanager: false
        class: nginx-external
      minio:
        enabled: false
      gitaly:
        enabled: true
        persistence:
          storageClass: "do-block-storage-retain"
          size: 50Gi
      postgressql:
        persistence:
          storageClass: "do-block-storage-retain"
        storageClass: "do-block-storage-retain"
      redis:
        persistence:
          storageClass: "do-block-storage-retain"
        storageClass: "do-block-storage-retain"
      appConfig:
        object_store:
          enabled: true
          connection:
            secret: "test"
    gitlab:
      toolbox:
        backups:
          objectStorage:
            config:
              secret: "test"
    certmanager:
      install: false
